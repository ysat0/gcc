2007-01-29  Kaloian Doganov  <kaloian@doganov.org>

	PR libgcj/30600:
	* gnu/gcj/convert/BytesToCharsetAdaptor.java (read): Fix call to
	'limit'.

2007-01-29  Kyle Galloway  <kgallowa@redhat.com>

	* include/java-interp.h:  Added _Jv_Frame class and its two
	subclasses _Jv_InterpFrame and _Jv_NativeFrame.  Also moved
	_Jv_FrameType from java-stack.h.
	* include/java-stack.h: Removed _Jv_FrameType.
	* java/lang/Thread.java: Added frame member to hold new
	composite frame stack.
	* java/lang/Thread.h: Regenerated.
	* java/lang/Thread.class: Rebuilt.
	* jni.cc (_Jv_JNIMethod::call): Push a frame onto the stack when
	calling a JNI method.
	* jvmti.cc (_Jv_JVMTI_GetStackTrace): New Method.
	(_Jv_JVMTI_GetFrameCount): New method.
	* stacktrace.cc (UnwindTraceFn): Modified to use new _Jv_Frame
	classes.
	* testsuite/libjava.jvmti/interp/getstacktrace.jar: New test.
	* testsuite/libjava.jvmti/interp/natgetstacktrace.cc: New test.
	* testsuite/libjava.jvmti/interp/getstacktrace.h: New test.
	* testsuite/libjava.jvmti/interp/getstacktrace.jar: New test.
	* testsuite/libjava.jvmti/interp/getstacktrace.out: Output file
	for test. 

2007-01-29  Tom Tromey  <tromey@redhat.com>

	* interpret.cc (run_debug): Remove comment.
	(STOREA): Reformat.
	(STOREI): Likewise.
	(STOREF): Likewise.
	(STOREL): Likewise.
	(STORED): Likewise.
	(POKEI): Likewise.
	(run_normal_debug): Likewise.
	(run_synch_object_debug): Likewise.
	(run_class_debug): Likewise.
	(run_synch_class_debug): Likewise.
	(get1s): Likewise.
	(get1u): Likewise.
	(get2u): Likewise.
	(get4): Likewise.
	(NULLARRAYCHECK): Likewise.
	(ARRAYBOUNDSCHECK): Likewise.
	* interpret-run.cc (insn_target) <breakpoint>: Tidy.

2007-01-29  Tom Tromey  <tromey@redhat.com>

	* configure, Makefile.in: Rebuilt.
	* Makefile.am (bin_SCRIPTS): Never install scripts/jar.
	* configure.ac (BASH_JAR): Removed conditional.
	(JAR): Prefer the jar found by AC_CHECK_PROGS.

2007-01-29  Tom Tromey  <tromey@redhat.com>

	* Makefile.in: Rebuilt.
	* Makefile.am (interpret.lo): New target.  Add -fwrap to
	AM_CXXFLAGS.

2007-01-29  Keith Seitz  <keiths@redhat.com>

	* include/jvmti_md.h (_CLASSPATH_VM_JVMTI_TYPES_DEFINED):
	Define.
	[__GCJ_JNI_IMPL__]: Define our own JVMTI types when building
	gcj. All jvmti object types now are defined to be their
	corresponding java classes.
	* jvmti.cc (_Jv_JVMTI_SuspendThread): Remove casting from
	jthread to Thread*.
	(_Jv_JVMTI_ResumeThread): Likewise.
	(_Jv_JVMTI_InterruptThread): Likewise.
	(_Jv_JVMTI_SetEventNotificationMode): Likewise.
	* gnu/classpath/jdwp/natVMVirtualMachine.cc
	(jdwpClassPrepareCB): Likewise.
	(jdwpThreadEndCB): Likewise.
	(jdwpThreadStartCB): Likewise.
	(jdwpVMInitCB): Likewise.
 
2007-01-28  Michele Sandri  <gpointorama@gmail.com>

	* gnu/java/nio/channels/natFileChannelWin32.cc
	(lock): Implemented.
	(unlock): Implemented.

2007-01-27  Andreas Tobler  <a.tobler@schweiz.org>

	PR libgcj/30513
	* configure.host: Add forgottten sysdep_dir to sparc. Add a flag to
	libgcj_flags to undefine 'sun' at compile time.
	* sysdep/sparc/locks.h (read_barrier): New functions for 32 and 64 bit
	Sparc.
	(write_barrier): Likewise.

2007-01-27  Keith Seitz  <keiths@redhat.com>

	* gnu/classpath/jdwp/natVMVirtualMachine.cc
	(getAllClassMethods): Move error handling to ...
	(throw_jvmti_error): ... here.
	(jdwpClassPrepareCB): New function.
	(jdwpThreadEndCB): New function.
	(jdwpThreadStartCB): New function.
	(jdwpVMDeathCB): New function.
	(jdwpVMInitCB): Define and enable callbacks for
	ClassPrepare, ThreadEnd, ThreadStart, and VMDeath.

2007-01-27  Jakub Jelinek  <jakub@redhat.com>

	* Makefile.am (generic_header_files): Add $(inner_nat_headers).
	* testsuite/Makefile.am (check-dejaGNU): Depend on compile-tests.
	(MYGCJH): New variable.
	(compile-tests): New goal.
	* Makefile.in: Rebuilt.
	* testsuite/Makefile.in: Rebuilt.

2007-01-26  Tom Tromey  <tromey@redhat.com>

	* Updated headers.

2007-01-25  Tom Tromey  <tromey@redhat.com>

	PR libgcj/29594:
	* gnu/gcj/convert/Convert.java (main): Correctly handle missing
	input or output encodings.  Removed unused local variables.

2007-01-25  Keith Seitz  <keiths@redhat.com>

	* include/jvmti-int.h (_Jv_GetJDWP_JVMTIEnv): Declare.
	* gnu/classpath/jdwp/natVMVirtualMachine.cc
	(_Jv_GetJDWP_JVMTIEnv): New function.
	* gnu/classpath/jdwp/natVMMethod.cc (getName): Implement.
	(getSignature): Implement.
	(getModifiers): Implement.

2007-01-25  Andrew Haley  <aph@redhat.com>

	* configure, Makefile.in, include/config.h.in: Rebuilt.
	* Makefile.am (libgcj_la_LIBADD): Removed $(LIBMAGIC).
	* configure.ac: Don't check for libmagic.
	* java/net/natVMURLConnection.cc (p_magic_open, p_magic_load,
	p_magic_close, p_magic_buffer): New globals.
	(init): Look up 'magic' functions.
	(guessContentTypeFromBuffer): Updated.

2007-01-25  Keith Seitz  <keiths@redhat.com>

	* jvmti.cc (_Jv_JVMTI_GetMethodName): New function.
	(_Jv_JVMTI_Interface): Define GetMethodName.
	* testsuite/libjava.jvmti/getmethodname.java: New file.
	* testsuite/libjava.jvmti/natgetmethodname.cc: New file.
	* testsuite/libjava.jvmti/getmethodname.out: New file. 

2007-01-24  Kyle Galloway  <kgallowa@redhat.com>

    * libjava/testsuite/libjava.jvmti/jvmti-interp.exp: New file.
    * libjava/testsuite/libjava.jvmti/interp: New folder.
    * libjava/testsuite/lib/libjava.exp (exec_gij): New Method.

2007-01-24  Keith Seitz  <keiths@redhat.com>

	* link.cc (_Jv_Linker::wait_for_state): Add JVMTI
	CLASS_PREPARE notification.

2007-01-24  Keith Seitz  <keiths@redhat.com>

	* interpret.cc: Include gnu/gcj/jvmti/Breakpoint.h,
	gnu/gcj/jvmti/BreakpointManager.h, jvmti.h, and jvmti-int.h
	* interpret-run.cc: Implement insn_breakpoint.

2007-01-24  Keith Seitz  <keiths@redhat.com>

	* prims.cc (_Jv_RunMain): Send JVMTI event notifications
	for VM_INIT and VM_DEATH instead of the JDWP notifications.

2007-01-24  Keith Seitz  <keiths@redhat.com>

	* gnu/classpath/jdwp/natVMVirtualMachine.cc
	(getAllClassMethods): Implement.

2007-01-24  Andrew Haley  <aph@redhat.com>

	* gnu/classpath/natVMStackWalker.cc: Call InitClass everywhere.
	(getClassContext) Add a barrier to prevent GetStackWalkerStack()
	from being sibcalled.

2007-01-24  Andrew Haley  <aph@redhat.com>

	* scripts/makemake.tcl (emit_bc_rule): Set the source filename.
	* sources.am: Rebuild.

2007-01-24  Andreas Krebbel  <krebbel1@de.ibm.com>

	* exception.cc (parse_lsda_header, PERSONALITY_FUNCTION): Replaced
	_Unwind_Word with _uleb128_t and _Unwind_SWord with _sleb128_t.

2007-01-23  H.J. Lu  <hongjiu.lu@intel.com>

	PR libgcj/30550
	* Makefile.am (ecjx_DEPENDENCIES): Add libgcj_bc.la if needed.
	* Makefile.in: Regenerated.

2007-01-22  Keith Seitz  <keiths@redhat.com>

	* gnu/classpath/jdwp/natVMVirtualMachine.cc
	(getClassMethod): Implement.

2007-01-22  Keith  Seitz  <keiths@redhat.com>

	* java/lang/Class.h (_Jv_GetClassStatus): Declare.
	* java/lang/natClass.cc (_Jv_GetClassStatus): New function.
	* jvmti.cc (_Jv_JVMTI_GetClassStatus): New function.
	(_Jv_JVMTI_Interface): Define GetClassStatus.

2007-01-22  Tom Tromey  <tromey@redhat.com>

	* configure: Rebuilt.
	* configure.ac (GCJ): Reverted patch of 2006-12-20.

2007-01-22  Tom Tromey  <tromey@redhat.com>

	PR java/29812:
	* testsuite/libjava.jni/pr29812.java: New file.
	* testsuite/libjava.jni/pr29812_injar.java: New file.
	* testsuite/libjava.jni/pr29812_injar.jar: New file.
	* testsuite/libjava.jni/pr29812.out: New file.
	* testsuite/libjava.jni/pr29812_injar.c: New file.
	* testsuite/libjava.jni/pr29812_injar.h: New file.
	* testsuite/libjava.jni/pr29812.jar: New file.
	* testsuite/libjava.jni/pr29812.c: New file.
	* testsuite/libjava.jni/pr29812.h: New file.
	* testsuite/libjava.jni/jni.exp (gcj_jni_get_cxxflags_invocation):
	New proc.
	(gcj_jni_invocation_test_one): Use it.
	(gcj_jni_pr29812): New proc.
	(gcj_jni_run): Use it.
	* java/lang/natRuntime.cc (_load): Push a new system frame before
	calling JNI_OnLoad.
	* include/jvm.h (_Jv_JNI_PopSystemFrame): Declare.
	(_Jv_GetJNIEnvNewFrameWithLoader): Likewise.
	* jni.cc (struct _Jv_JNI_LocalFrame) <marker>: Now unsigned char.
	<allocated_p>: Now bool.
	<loader>: New field.
	(_Jv_JNI_EnsureLocalCapacity): Updated.
	(_Jv_JNI_NewLocalRef): Likewise.
	(_Jv_JNI_NewLocalRef): Likewise.
	(_Jv_JNI_PopLocalFrame): Likewise.
	(_Jv_JNI_FindClass): Likewise.
	(_Jv_GetJNIEnvNewFrame): Likewise.
	(_Jv_JNI_AttachCurrentThread): Likewise.
	(_Jv_GetJNIEnvNewFrameWithLoader): New function.
	(_Jv_GetJNIEnvNewFrame): Use it.
	* include/jni_md.h (_CLASSPATH_JNIENV_CONTENTS): Removed 'klass'.

2007-01-22  Tom Tromey  <tromey@redhat.com>

	* libtool-version: Bump current to 9.

2007-01-22  Andrew Haley  <aph@redhat.com>

	* sysdep/alpha/locks.h (write_barrier): New.

2007-01-21  Matthias Klose  <doko@debian.org>

	* Makefile.am (install-exec-hook): Use transformed name.
	* Makefile.in: Regenerate.

2007-01-19  Keith Seitz  <keiths@redhat.com>

	* gnu/classpath/jdwp/natVMVirtualMachine.cc: Mark unused parameters
	in methods and reformat.

	* gnu/classpath/jdwp/natVMFrame.cc: Mark unused parameters with
	MAYBE_UNUSED.

2007-01-18  Keith Seitz  <keiths@redhat.com>

	From Macro Trudel <mtrudel@gmx.ch>:
	* gnu/classpath/jdwp/natVMVirtualMachine.cc (jdwpVMInitCB):
	Use JNICALL.

2007-01-18  Marco Trudel  <mtrudel@gmx.ch>

	* jni.cc (_Jv_JNI_FindClass): Initialize class.
	* testsuite/libjava.jni/findclass2.jar: New file.
	* testsuite/libjava.jni/findclass2.h: New file.
	* testsuite/libjava.jni/findclass2.java: New file
	* testsuite/libjava.jni/findclass2.c: New file.
	* testsuite/libjava.jni/findclass2.out: New file.

2007-01-18  Tom Tromey  <tromey@redhat.com>

	* configure: Rebuilt.
	* configure.ac: Use multi_basedir instead of libgcj_basedir.

2007-01-18  Gary Benson  <gbenson@redhat.com>

	* gnu/java/nio/natVMPipeEcos.cc:
	Renamed from gnu/java/nio/natPipeImplEcos.cc.
	* gnu/java/nio/natVMPipePosix.cc:
	Renamed from gnu/java/nio/natPipeImplPosix.cc.
	* gnu/java/nio/natVMPipeWin32.cc:
	Renamed from gnu/java/nio/natPipeImplWin32.cc.
	* gnu/java/nio/natVMSelectorEcos.cc:
	Renamed from gnu/java/nio/natSelectorImplEcos.cc.
	* gnu/java/nio/natVMSelectorPosix.cc:
	Renamed from gnu/java/nio/natSelectorImplPosix.cc.
	* gnu/java/nio/natVMSelectorWin32.cc:
	Renamed from gnu/java/nio/natSelectorImplWin32.cc.
	* java/io/natVMObjectInputStream.cc:
	Renamed from java/io/natObjectInputStream.cc.
	* java/lang/natVMDouble.cc:
	Renamed from java/lang/natDouble.cc.
	* java/lang/natVMFloat.cc:
	Renamed from java/lang/natFloat.cc.	
	* Makefile.am, configure.ac: Reflect the above.
	* Makefile.in, configure: Rebuilt.

2007-01-17  Andrew Haley  <aph@redhat.com>

	* Makefile.in: Rebuilt.
	* Makefile.am (ecjx_LDFLAGS): Pass -fbootclasspath.

2007-01-17  Keith Seitz  <keiths@redhat.com>

	* java/lang/natThread.cc (finish_): Add JVMTI ThreadEnd notification.
	(_Jv_NotifyThreadStart): Add JVMTI ThreadStart notification.

2007-01-16  Jack Howarth  <howarth@bromo.med.uc.edu>

	* configure.ac: Use multi.m4 from aclocal rather than custom
	code.  Use multi_basedir instead libgcj_basedir.  Test for
	/proc/self/exe when not cross-compiling.
	* aclocal.m4: Regenerate.
	* configure: Regenerate.
	* Makefile.in: Regenerate.

2007-01-17  Gary Benson  <gbenson@redhat.com>

	* java/nio/natVMDirectByteBufferImpl.cc:
	Renamed from java/nio/natDirectByteBufferImpl.cc.
	* Makefile.am: Reflect the above.
	* Makefile.in: Rebuilt.
	
2007-01-17  Marco Trudel  <mtrudel@gmx.ch>

	* jvmti.cc (_Jv_JVMTI_GetAllThreads): Now static.  Use JNICALL.
	Fixed indentation.  Removed unused variable.

2007-01-16  Tom Tromey  <tromey@redhat.com>

	* java/lang/natThread.cc (finalize_native): Remove cast.
	(_Jv_GetCurrentJNIEnv): Likewise.
	* include/jvm.h (struct natThread) <jni_env>: Declare as
	_Jv_JNIEnv*.

2007-01-16  Keith Seitz  <keiths@redhat.com>

	* testsuite/libjava.jvmti/natevents.cc (FieldModificationCB): Use
	%#llx instead of %d for new_value.
	* testsuite/libjava.jvmti/events.out: Update expected output.
	* testsuite/libjava.jvmti/events.jar: Regenerate.

2007-01-16  Keith Seitz  <keiths@redhat.com>

	* gnu/classpath/jdwp/natVMVirtualMachine.cc (DEFINE_CALLBACK):
	New macro.
	(ENABLE_EVENT): New macro.
	(initialize): Define and enable JVMTI VM_INIT callback.
	(jdwpVMInitCB): New function.

2007-01-16  Kyle Galloway  <kgallowa@redhat.com>

	* jvmti.cc (_Jv_JVMTI_GetAllThreads): New function.
	* testsuite/libjava.jvmti/getallthreads.java: New test.
	* testsuite/libjava.jvmti/natgetallthreads.cc: Ditto.
	* testsuite/libjava.jvmti/getallthreads.out: Ditto.
	* testsuite/libjava.jvmti/getallthreads.h: Ditto.
	* testsuite/libjava.jvmti/getallthreads.jar: Ditto. 

2007-01-15  Keith Seitz  <keiths@redhat.com>

	* gnu/classpath/jdwp/natVMVirtualMachine.cc (suspendThread): Use
	java.lang.StringBuilder instead of java.lang.StringBuffer.
	(resumeThread): Likewise.

2007-01-15  Gary Benson  <gbenson@redhat.com>

	* java/nio/MappedByteBuffer.java: Removed.
	* sources.am, Makefile.in: Rebuilt.

2007-01-15  Gary Benson  <gbenson@redhat.com>

	* java/net/URLClassLoader.java: Removed.
	* gnu/java/net/loader/Load_gcjlib.java: New file.
	* gnu/gcj/runtime/BootClassLoader.java: Ensure core
	URL handler is present in static executables.
	* sources.am, Makefile.in: Rebuilt.

2007-01-14  H.J. Lu  <hongjiu.lu@intel.com>

	* Makefile.am (libgcj_la_LDFLAGS): Add
	$(LIBGCJ_LD_SYMBOLIC_FUNCTIONS).
	(libgcj_tools_la_LDFLAGS): Likewise.
	(libgcj_bc_la_LDFLAGS): Likewise.
	* Makefile.in: Regenerated.

	* configure.ac: Use ACX_PROG_LD_GNU_SYMBOLIC.  Set
	LIBGCJ_LD_SYMBOLIC_FUNCTIONS to $SYMBOLIC_LDFLAGS.  Set
	libgcj_ld_symbolic to $SYMBOLIC_LDFLAGS if it isn't set.
	Substitute LIBGCJ_LD_SYMBOLIC_FUNCTIONS.
	* configure: Regenerated.
	* aclocal.m4: Likewise.
	* gcj/Makefile.in: Likewise.
	* include/Makefile.in: Likewise.
	* testsuite/Makefile.in: Likewise.

2007-01-12  Kaz Kojima  <kkojima@gcc.gnu.org>

	* sysdep/sh/locks.h (read_barrier): New.
	(write_barrier): Likewise.

2007-01-12  Andrew Haley  <aph@redhat.com>

	* include/i386-signal.h: Rewrite to use rt_sigaction.

2007-01-11  Andrew Haley  <aph@redhat.com>

	* prims.cc (jdwpOptions) Fix deprecated cast from char[] constant
	to char*.
	* include/x86_64-signal.h (HANDLE_DIVIDE_OVERFLOW): Rewrite to fix
	aliasing violation.

2007-01-10  Tom Tromey  <tromey@redhat.com>

	* gnu/gcj/xlib/*.h: New files.
	* gnu/awt/xlib/*.h: Likewise.
	* classpath/lib/gnu/gcj/xlib: New class files.
	* classpath/lib/gnu/awt/xlib: Likewise.

2007-01-10  Tom Tromey  <tromey@redhat.com>

	* HACKING: Various updates.

2007-01-10  Tom Tromey  <tromey@redhat.com>

	* java/lang/natDouble.cc (toString): Added parens.
	* gnu/gcj/io/shs.h (PROTO): Define.
	* link.cc (resolve_pool_entry): Added missing braces.

2007-01-10  H.J. Lu  <hongjiu.lu@intel.com>

	PR libgcj/30424
	* sysdep/ia64/locks.h (read_barrier): New.
	(write_barrier): New.

2007-01-10  Gary Benson  <gbenson@redhat.com>

	* java/net/URL.java: Removed.
	* sources.am, Makefile.in: Rebuilt.

2007-01-10  Matthias Klose  <doko@debian.org>

	* Makefile.am (install-exec-hook): Support $(DESTDIR).
	* Makefile.in: Regenerated.

2007-01-05  Tom Tromey  <tromey@redhat.com>

	* testsuite/libjava.loader/loader.exp (gcj_loader_run): Find
	dummy.class in srcdir.

2007-01-03  Tom Tromey  <tromey@redhat.com>

	* testsuite/libjava.cni/cni.exp (gcj_cni_compile_cxx_to_o): Add -I
	for srcdir.

2007-01-03  Tom Tromey  <tromey@redhat.com>

	* testsuite/*: Added many .jar and .h files.
	* testsuite/libjava.special/special.exp
	(gcj_special_try_compiler): New proc.
	* testsuite/libjava.loader/loader.exp (gcj_loader_run): Don't
	bytecompile source.  Search for .jar files.
	(gcj_loader_test_one): Don't look for MyLoader.java.
	* testsuite/libjava.jvmti/jvmti.exp (gcj_jvmti_test_one): Don't
	bytecompile sources or build headers.
	(gcj_jvmti_run): Look for .jar files.
	* testsuite/libjava.jni/jni.exp (gcj_jni_run): Compile .jar
	files.
	(gcj_jni_test_one): Don't bytecompile sources or build headers.
	Set classpath when invoking gij.
	(gcj_jni_invocation_test_one): Likewise.
	* testsuite/libjava.cni/cni.exp (gcj_cni_test_one): Don't build
	headers or bytecompile sources.
	(gcj_cni_run): Use .jar files, not .java files.
	* testsuite/libjava.lang/lang.exp: Compile .jar files.

2007-01-02  Tom Tromey  <tromey@redhat.com>

	* configure: Rebuilt.
	* configure.ac: Check for gjar.

2007-01-02  Tom Tromey  <tromey@redhat.com>

	* testsuite/libjava.jacks/jacks.exp: Removed.
	* testsuite/libjava.jacks/jacks.xfail: Removed.

