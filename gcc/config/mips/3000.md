;; DFA based pipeline description for the r3000
;; This is a special pipeline - this is also the default schedule and
;; so we need to schedule instructions that may not exist on the r2k/r3k.

(define_automaton "r3k_alu,r3k_imuldiv")

(define_cpu_unit "r3k_alu" "r3k_alu")
(define_cpu_unit "r3k_imuldiv" "r3k_imuldiv")

(define_insn_reservation "r3k_generic" 1
  (and (eq_attr "cpu" "r3000")
       (eq_attr "type" "unknown,prefetch,prefetchx,condmove,const,arith,
			shift,slt,clz,trap,multi,nop"))
  "r3k_alu")

(define_insn_reservation "r3k_load" 2
  (and (eq_attr "cpu" "r3000")
       (eq_attr "type" "load,fpload,fpidxload,xfer"))
  "r3k_alu")

(define_insn_reservation "r3k_store" 1
  (and (eq_attr "cpu" "r3000")
       (eq_attr "type" "store,fpstore,fpidxstore"))
  "r3k_alu")

(define_insn_reservation "r3k_branch" 1
  (and (eq_attr "cpu" "r3000")
       (eq_attr "type" "branch,jump,call"))
  "r3k_alu")

(define_insn_reservation "r3k_hilo" 1
  (and (eq_attr "cpu" "r3000")
       (eq_attr "type" "mfhilo,mthilo"))
  "r3k_imuldiv*3")

(define_insn_reservation "r3k_imul" 12
  (and (eq_attr "cpu" "r3000")
       (eq_attr "type" "imul,imadd"))
  "r3k_imuldiv*12")

(define_insn_reservation "r3k_idiv" 35
  (and (eq_attr "cpu" "r3000")
       (eq_attr "type" "idiv"))
  "r3k_imuldiv*35")

(define_insn_reservation "r3k_fmove" 1
  (and (eq_attr "cpu" "r3000")
       (eq_attr "type" "fabs,fneg,fmove,fcvt"))
  "r3k_alu")

(define_insn_reservation "r3k_fadd" 2
  (and (eq_attr "cpu" "r3000")
       (eq_attr "type" "fcmp,fadd"))
  "r3k_alu")

(define_insn_reservation "r3k_fmul_single" 4
  (and (eq_attr "cpu" "r3000")
       (and (eq_attr "type" "fmul,fmadd")
	    (eq_attr "mode" "SF")))
  "r3k_alu")

(define_insn_reservation "r3k_fmul_double" 5
  (and (eq_attr "cpu" "r3000")
       (and (eq_attr "type" "fmul,fmadd")
	    (eq_attr "mode" "DF")))
  "r3k_alu")

(define_insn_reservation "r3k_fdiv_single" 12
  (and (eq_attr "cpu" "r3000")
       (and (eq_attr "type" "fdiv,fsqrt,frsqrt")
	    (eq_attr "mode" "SF")))
  "r3k_alu")

(define_insn_reservation "r3k_fdiv_double" 19
  (and (eq_attr "cpu" "r3000")
       (and (eq_attr "type" "fdiv,fsqrt,frsqrt")
	    (eq_attr "mode" "DF")))
  "r3k_alu")
