#if __SIZEOF_LONG_LONG__ == 8
typedef unsigned long long V __attribute__((vector_size(16), may_alias));

struct S
{
  V in1, in2, mask, out;
};

struct S tests[] = {
  {
    { 0x1112131415161718, 0x2122232425262728 },
    { 0x3132333435363738, 0x4142434445464748 },
    { 0, 1 },
    { 0x1112131415161718, 0x2122232425262728 },
  },
  {
    { 0x1112131415161718, 0x2122232425262728 },
    { 0x3132333435363738, 0x4142434445464748 },
    { 2, 3 },
    { 0x3132333435363738, 0x4142434445464748 },
  },
  {
    { 0x1112131415161718, 0x2122232425262728 },
    { 0x3132333435363738, 0x4142434445464748 },
    { 0, 2 },
    { 0x1112131415161718, 0x3132333435363738 },
  },
  {
    { 0x1112131415161718, 0x2122232425262728 },
    { 0x3132333435363738, 0x4142434445464748 },
    { 2, 1 },
    { 0x3132333435363738, 0x2122232425262728 },
  },
  {
    { 0x1112131415161718, 0x2122232425262728 },
    { 0x3132333435363738, 0x4142434445464748 },
    { 3, 0 },
    { 0x4142434445464748, 0x1112131415161718 },
  },
  {
    { 0x1112131415161718, 0x2122232425262728 },
    { 0x3132333435363738, 0x4142434445464748 },
    { 0, 0 },
    { 0x1112131415161718, 0x1112131415161718 },
  },
  {
    { 0x1112131415161718, 0x2122232425262728 },
    { 0x3132333435363738, 0x4142434445464748 },
    { 3, 3 },
    { 0x4142434445464748, 0x4142434445464748 },
  },
};

extern void abort(void);

int main()
{
  int i;

  for (i = 0; i < sizeof(tests)/sizeof(tests[0]); ++i)
    {
      V r = __builtin_shuffle(tests[i].in1, tests[i].in2, tests[i].mask);
      if (__builtin_memcmp(&r, &tests[i].out, sizeof(V)) != 0)
	abort();
    }

  return 0;
}

#endif /* SIZEOF_LONG_LONG */
